"use strict";function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),i.forEach(function(t){_defineProperty(e,t,n[t])})}return e}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}!function(){var t=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.actions={},this.listeners=[],this.reactions=[],this._state=t.initialState||{},this.dev=t.dev,this.dev&&this.listen("*",function(t){console.log(t)}),this.dispatch=this.dispatch.bind(this),this.action=this.action.bind(this),this.listen=this.listen.bind(this),this.reaction=this.reaction.bind(this)}return _createClass(e,[{key:"action",value:function(t,s){this.actions[t]=function(i,r){return new Promise(function(t,e){var n=s(i,r);n||void 0===n?t(n):e()})}}},{key:"listen",value:function(t,e){var n=this,i={props:"string"==typeof t?[t]:t,fn:e,unsubscribe:function(){var t=n.listeners.indexOf(i);n.listeners.splice(t,1)}};return this.listeners.push(i),i.unsubscribe}},{key:"reaction",value:function(t,e){var n=this,i={props:"string"==typeof t?[t]:t,fn:e};this.reactions.push(i);var r={};i.props.forEach(function(t){r[t]=n._state[t]});var s=e(r,this._state);return this._updateState(s),i}},{key:"_updateState",value:function(r){var s=this;this._state=_objectSpread({},this._state,r);var o=Object.keys(r);this.listeners.forEach(function(t){var e=t.props,n=t.fn;e[0]&&"*"===e[0]?n(r,s._state):0<e.filter(function(t){return o.includes(t)}).length&&n(r,s._state)}),this.reactions.forEach(function(t){var e=t.props,n=t.fn;if(0<e.filter(function(t){return o.includes(t)}).length){var i=n(r,s._state);i&&s._updateState(i)}})}},{key:"dispatch",value:function(e,t){var n=this,i=this.actions[e];if(i)return i(t||{},this._state).then(function(t){return t?(n._updateState(t),t):{}}).catch(function(t){return console.error("error in action '".concat(e,"'"),t),{}});console.error("no action with name ".concat(e))}}]),e}();"undefined"!=typeof module&&void 0!==module.exports?module.exports=t:window.Juicr=t}();